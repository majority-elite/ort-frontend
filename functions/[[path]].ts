import { createPagesFunctionHandler } from '@remix-run/cloudflare-pages';
import { type ContextEnv, getLoadContext } from '@server';

// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-ignore - the server build file is generated by `remix vite:build`
// eslint-disable-next-line import/no-unresolved, import/order, no-restricted-imports
import * as build from '../build/server';

export const onRequest = async (
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  context: EventContext<ContextEnv, any, any>,
): Promise<Response> => {
  const handleRequest = createPagesFunctionHandler<ContextEnv>({
    build,
    getLoadContext: (args) =>
      getLoadContext(args, {
        authCookieSessionSecret: import.meta.env
          .SERVER_AUTH_COOKIE_SESSION_SECRET,
      }),
  });

  const response = await handleRequest(context);

  return response;
};
